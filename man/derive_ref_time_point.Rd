% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mod_g6_derive_flags.R
\name{derive_ref_time_point}
\alias{derive_ref_time_point}
\title{Derive reference time point variables (--STRTPT/--STTPT or --ENRTPT/--ENTPT)}
\usage{
derive_ref_time_point(
  data,
  rtpt_var,
  tpt_var,
  source_var,
  tpt_label,
  mode = c("pattern", "value"),
  mapping = list(BEFORE = "before", AFTER = "after")
)
}
\arguments{
\item{data}{Tibble.}

\item{rtpt_var}{Character. The --STRTPT or --ENRTPT target variable.}

\item{tpt_var}{Character. The --STTPT or --ENTPT target variable.}

\item{source_var}{Character. Raw source column to evaluate.}

\item{tpt_label}{Character. Label for the reference time point (e.g.,
\code{"FIRST PRODUCT INTAKE"} or \code{"END OF STUDY"}).}

\item{mode}{Character. \code{"pattern"} for substring matching, \code{"value"}
for direct value mapping. Default \code{"pattern"}.}

\item{mapping}{Named list. For \code{"pattern"} mode: names are SDTM values
(e.g., \code{"BEFORE"}, \code{"AFTER"}), values are regex patterns to search for.
For \code{"value"} mode: names are SDTM values, values are raw values to
match (case-insensitive).
Default handles the AESTRTPT pattern: \code{list("BEFORE" = "before", "AFTER" = "after")}.}
}
\value{
Tibble with \code{rtpt_var} and \code{tpt_var} populated.
}
\description{
Handles the common SDTM pattern where a reference time point (e.g.,
"BEFORE", "AFTER", "ONGOING") is derived from a raw CRF variable,
and a companion label variable is set when the time point is non-missing.
}
\details{
Two modes are supported via the \code{mode} parameter:
\describe{
\item{\code{"pattern"}}{Text pattern matching on \code{source_var} (e.g.,
\code{AeStPer} → check for "BEFORE" / "AFTER" substrings).}
\item{\code{"value"}}{Direct value mapping on \code{source_var} (e.g.,
\code{AeOnGo} "Y" → "ONGOING", "N" → "BEFORE").}
}
}
