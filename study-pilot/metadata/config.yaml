# =============================================================================
# sdtmbuilder configuration for STUDY-PILOT
# =============================================================================

studyid: "STUDY-PILOT"
timezone: "UTC"

# Reference start date: RFSTDTC comes from DM (icdat â†’ RFSTDTC in SAS DM.sas)
ref_start_rule:
  method: "dm_var"
  dataset: "dm_raw"
  column: "rfstdtc"

# Paths (relative to where run_study() is called, or absolute)
paths:
  metadata: "metadata/Study_Metadata.xlsx"
  ct: "metadata/Study_CT.xlsx"
  raw_data: "raw"
  output: "sdtm/datasets"
  programs: "sdtm/programs"

# Export formats
export:
  formats:
    - "xpt"
    - "rda"
  generate_programs: true

# Controlled terminology
ct:
  files:
    - "metadata/Study_CT.xlsx"

# Study metadata
metadata:
  file: "metadata/Study_Metadata.xlsx"

# Visit map
# Maps EventId to VISIT, VISITNUM, VISITDY
visit_source_var: "eventid"
visit_map:
  - code: "SCR"
    visit: "Visit 0: Screening"
    visitnum: 1
    visitdy: 1
  - code: "V1"
    visit: "Visit 1"
    visitnum: 2
    visitdy: 1
  - code: "V1_IMG"
    visit: "Visit 1"
    visitnum: 2
    visitdy: 1
  - code: "PW1"
    visit: "Phone Call 1"
    visitnum: 3
    visitdy: 8
  - code: "PW5"
    visit: "Phone Call 2"
    visitnum: 4
    visitdy: 36
  - code: "V2"
    visit: "Visit 2"
    visitnum: 5
    visitdy: 71
  - code: "PW15"
    visit: "Phone Call 3"
    visitnum: 6
    visitdy: 106
  - code: "PW20"
    visit: "Phone Call 4"
    visitnum: 7
    visitdy: 140
  - code: "V3"
    visit: "Visit 3"
    visitnum: 8
    visitdy: 141
  - code: "V3_IMG"
    visit: "Visit 3"
    visitnum: 8
    visitdy: 141
  - code: "PFU"
    visit: "Phone Call 5: Follow-up"
    visitnum: 9
    visitdy: 155

# Epoch map (add when needed)
# epoch_map: []

# Planned time points
# These are diary time points (ActivityID-based).  Days 1-7 within each
# collection week; each week references a study milestone visit.
# Used for domains that collect diary data (e.g. FA, QS with diary).
tpt_source_var: "activityid"
timepoint_map:
  # Week after Visit 1 (Days 1-7)
  - code: "D1W1_SPI"
    tpt: "Day 1"
    tptnum: 1
    tptref: "Week after Visit 1"
    eltm: "P1D"
  - code: "D2W1_SPI"
    tpt: "Day 2"
    tptnum: 2
    tptref: "Week after Visit 1"
    eltm: "P2D"
  - code: "D3W1_SPI"
    tpt: "Day 3"
    tptnum: 3
    tptref: "Week after Visit 1"
    eltm: "P3D"
  - code: "D4W1_SPI"
    tpt: "Day 4"
    tptnum: 4
    tptref: "Week after Visit 1"
    eltm: "P4D"
  - code: "D5W1_SPI"
    tpt: "Day 5"
    tptnum: 5
    tptref: "Week after Visit 1"
    eltm: "P5D"
  - code: "D6W1_SPI"
    tpt: "Day 6"
    tptnum: 6
    tptref: "Week after Visit 1"
    eltm: "P6D"
  - code: "D7W1_SPI"
    tpt: "Day 7"
    tptnum: 7
    tptref: "Week after Visit 1"
    eltm: "P7D"
  # Week before Phone Call 2 (Days 1-7)
  - code: "D1W5_SPI"
    tpt: "Day 1"
    tptnum: 1
    tptref: "Week before Phone Call 2"
    eltm: "P1D"
  - code: "D2W5_SPI"
    tpt: "Day 2"
    tptnum: 2
    tptref: "Week before Phone Call 2"
    eltm: "P2D"
  - code: "D3W5_SPI"
    tpt: "Day 3"
    tptnum: 3
    tptref: "Week before Phone Call 2"
    eltm: "P3D"
  - code: "D4W5_SPI"
    tpt: "Day 4"
    tptnum: 4
    tptref: "Week before Phone Call 2"
    eltm: "P4D"
  - code: "D5W5_SPI"
    tpt: "Day 5"
    tptnum: 5
    tptref: "Week before Phone Call 2"
    eltm: "P5D"
  - code: "D6W5_SPI"
    tpt: "Day 6"
    tptnum: 6
    tptref: "Week before Phone Call 2"
    eltm: "P6D"
  - code: "D7W5_SPI"
    tpt: "Day 7"
    tptnum: 7
    tptref: "Week before Phone Call 2"
    eltm: "P7D"
  # Week before Visit 2 (Days 1-7)
  - code: "D1W10_SPI"
    tpt: "Day 1"
    tptnum: 1
    tptref: "Week before Visit 2"
    eltm: "P1D"
  - code: "D2W10_SPI"
    tpt: "Day 2"
    tptnum: 2
    tptref: "Week before Visit 2"
    eltm: "P2D"
  - code: "D3W10_SPI"
    tpt: "Day 3"
    tptnum: 3
    tptref: "Week before Visit 2"
    eltm: "P3D"
  - code: "D4W10_SPI"
    tpt: "Day 4"
    tptnum: 4
    tptref: "Week before Visit 2"
    eltm: "P4D"
  - code: "D5W10_SPI"
    tpt: "Day 5"
    tptnum: 5
    tptref: "Week before Visit 2"
    eltm: "P5D"
  - code: "D6W10_SPI"
    tpt: "Day 6"
    tptnum: 6
    tptref: "Week before Visit 2"
    eltm: "P6D"
  - code: "D7W10_SPI"
    tpt: "Day 7"
    tptnum: 7
    tptref: "Week before Visit 2"
    eltm: "P7D"
  # Week before Phone Call 3 (Days 1-7)
  - code: "D1W15_SPI"
    tpt: "Day 1"
    tptnum: 1
    tptref: "Week before Phone Call 3"
    eltm: "P1D"
  - code: "D2W15_SPI"
    tpt: "Day 2"
    tptnum: 2
    tptref: "Week before Phone Call 3"
    eltm: "P2D"
  - code: "D3W15_SPI"
    tpt: "Day 3"
    tptnum: 3
    tptref: "Week before Phone Call 3"
    eltm: "P3D"
  - code: "D4W15_SPI"
    tpt: "Day 4"
    tptnum: 4
    tptref: "Week before Phone Call 3"
    eltm: "P4D"
  - code: "D5W15_SPI"
    tpt: "Day 5"
    tptnum: 5
    tptref: "Week before Phone Call 3"
    eltm: "P5D"
  - code: "D6W15_SPI"
    tpt: "Day 6"
    tptnum: 6
    tptref: "Week before Phone Call 3"
    eltm: "P6D"
  - code: "D7W15_SPI"
    tpt: "Day 7"
    tptnum: 7
    tptref: "Week before Phone Call 3"
    eltm: "P7D"
  # Week before Visit 3 (Days 1-7)
  - code: "D1W20_SPI"
    tpt: "Day 1"
    tptnum: 1
    tptref: "Week before Visit 3"
    eltm: "P1D"
  - code: "D2W20_SPI"
    tpt: "Day 2"
    tptnum: 2
    tptref: "Week before Visit 3"
    eltm: "P2D"
  - code: "D3W20_SPI"
    tpt: "Day 3"
    tptnum: 3
    tptref: "Week before Visit 3"
    eltm: "P3D"
  - code: "D4W20_SPI"
    tpt: "Day 4"
    tptnum: 4
    tptref: "Week before Visit 3"
    eltm: "P4D"
  - code: "D5W20_SPI"
    tpt: "Day 5"
    tptnum: 5
    tptref: "Week before Visit 3"
    eltm: "P5D"
  - code: "D6W20_SPI"
    tpt: "Day 6"
    tptnum: 6
    tptref: "Week before Visit 3"
    eltm: "P6D"
  - code: "D7W20_SPI"
    tpt: "Day 7"
    tptnum: 7
    tptref: "Week before Visit 3"
    eltm: "P7D"

# Policies
policies:
  unknown_ct: "WARN_AND_KEEP"
  date_partial_allowed: true
  imputation:
    day: "first"
    month: null
    year: null
  join_cardinality_default: "m:1"
  blank_is_na: true
  na_strings:
    - "."
    - "UNK"
    - "NA"

# SUPP domain generation: keep SUPP variables in SUPPAE
create_supp: true

# Study day convention
study_day:
  convention: "no_day_zero"

log_level: "INFO"

sponsor_overrides: {}
